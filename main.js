var attemps = {};
// var attemps = {
//     _508: [
//         { id: "13-20-83dcefb7" },
//         { id: "15-20-1ad5be0d" },
//         { id: "15-20-6dd28e9b" },
//         { id: "17-20-f3b61b38" },
//         { id: "19-20-1db87a14" },
//         { id: "19-20-6abf4a82" },
//         { id: "19-20-4f5344cd" },
//         { id: "20-20-8d076785" },
//         { id: "20-20-a15d25e1" },
//         { id: "20-20-fa005713" },
//         { id: "20-20-4f5344cd" },
//         { id: "20-20-3854745b" },
//         { id: "20-20-a630e1f8" },
//         { id: "20-20-d137d16e" },
//     ],
//     _509: [
//         { id: "17-20-1ad5be0d" },
//         { id: "17-20-83dcefb7" },
//         { id: "18-20-6dd28e9b" },
//         { id: "18-20-f3b61b38" },
//         { id: "19-20-1db87a14" },
//         { id: "19-20-6abf4a82" },
//         { id: "19-20-84b12bae" },
//         { id: "19-20-a15d25e1" },
//         { id: "19-20-84b12bai" },
//         { id: "19-20-d137d16e" },
//         { id: "20-20-8d076785" },
//         { id: "20-20-a15d25e1" },
//         { id: "20-20-fa005713" },
//         { id: "20-20-3854745b" },
//         { id: "20-20-647e170e" },
//         { id: "20-20-6cc2f544" },
//     ],
//     _510: [
//         { id: "15-20-_29210471_1" },
//         { id: "15-20-_29751057_1" },
//         { id: "16-20-_29215871_1" },
//         { id: "16-20-_29410211_1" },
//         { id: "16-20-_29732374_1" },
//         { id: "17-20-_29611630_1" },
//         { id: "17-20-_29743096_1" },
//         { id: "17-20-_29744898_1" },
//         { id: "18-20-_29751241_1" },
//         { id: "17-20-_29756515_1" },
//         { id: "16-20-_29756610_1" },
//         { id: "16-20-_29757467_1" },
//         { id: "17-20-_29757422_1" },
//         { id: "14-20-_29749446_1" },
//         { id: "19-20-_29758664_1" },
//         { id: "19-20-_30357423_1" },
//         { id: "17-20-_30363013_1" },
//         { id: "17-20-_30331286_1" },
//         { id: "17-20-_30436829_1" },
//     ],
//     _145: [
//         { "id": "15-20-_33036050_1" },
//         { "id": "16-20-_33181288_1" },
//         { "id": "16-20-_33181833_1" },
//         { "id": "16-20-_33302866_1" },
//         { "id": "16-20-_33315943_1" },
//         { "id": "17-20-_33258436_1" },
//         { "id": "17-20-_33277039_1" },
//         { "id": "17-20-_33298886_1" },
//         { "id": "18-20-_33139509_1" },
//         { "id": "18-20-_33151978_1" },
//         { "id": "18-20-_33174278_1" },
//         { "id": "19-20-_33088656_1" },
//         { "id": "19-20-_33249583_1" },
//         { "id": "19-20-_33268818_1" },
//         { "id": "19-20-_33667723_1" },
//         { "id": "20-20-_33661552_1" }
//     ],
//     _RATest1: [
//         { id: "4-20-_28931032_1" },
//         { id: "8-20-_28931312_1" },
//         { id: "20-20-_28931563_1" },
//     ],
//     _RATest2: [
//         { id: "12-20-_27382152_1" },
//         { id: "12-20-_27429919_1" },
//         { id: "20-20-_27430579_1" },
//     ],
//     _RATest3: [
//         { id: "16-20-_27430628_1" },
//         { id: "16-20-_27431309_1" },
//         { id: "20-20-_27434482_1" },
//     ],
//     _511: [
//         { id: "18-20-_31457890_1" },
//         { id: "18-20-_31460618_1" },
//         { id: "19-20-_31380290_1" },
//         { id: "20-20-_31391552_1" },
//         { id: "20-20-_31448982_1" },
//         { id: "19-20-_31485434_1" },
//         { id: "19-20-_31487055_1" },
//         { id: "20-20-_31488505_1" },
//         { id: "19-20-_31490009_1" },
//         { id: "19-20-_31490846_1" },
//         { id: "20-20-_31493761_1" },
//         { id: "20-20-_31494046_1" },
//     ],
// };

function getData(course) {
    attemps[`_${course}`].forEach((attemp, key) => {
        $.getJSON(`${course}/${attemp.id}.json`, res => {
            attemps[`_${course}`][key].data = res;
            attemps[`_${course}`][key].nota = attemp.id.substr(0, 2);
        })
    })
}

$(function () {
    $('#examen').trigger('change');
})

$(document).on('change', '#examen', async function () {
    var res = await fetch('./prueba.php?course=' + $(this).val());
    var data = await res.json();
    attemps[`_${$(this).val()}`] = data;
    getData($(this).val());
})

$(document).on('change', '#query', function () {
    var query = $(this).val();
    var examen = $('#examen').val();
    $('#results tbody').empty();
    attemps[`_${examen}`].forEach(attemp => {
        attemp.data.forEach(question => {
            if (
                question.question.replaceAll(' ', '').replaceAll('\n', '')
                ==
                query.replaceAll(' ', '').replaceAll('\n', '')
            ) {
                $('#results tbody').append(`
                <tr>
                    <td>${attemp.id}</td>
                    <td id="${attemp.id}"></td>
                    <td width="0%">${attemp.nota}</td>
                    <td>${question.correct}</td>
                </tr>
                `);
                $(`#${attemp.id}`).text(question.selected);
            }
        })
    })
})